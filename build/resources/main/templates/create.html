<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>남포교회 주보 생성</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="shortcut icon" type="image/x-icon" href="images/lamp.jpg">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/browser.min.js"></script>
    <script src="/js/breakpoints.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
</head>
<body class="is-preload">

<!-- Wrapper -->
<div id="wrapper" th:if="${#httpServletRequest.getSession(false) != null}">

    <!-- Main -->
    <div id="main">
        <div class="inner">
            <!-- Header -->
            <header id="header">
                <a th:href="@{/create}" class="logo">
                    <h1>주보 생성</h1>
                </a>
            </header>
            <form id="uploadForm" enctype="multipart/form-data" >
                <!-- Content -->
                <section>
                    <hr class="main">
                    <header class="main">
                        <div class="row">
                            <div class="row">
                                <h2>날짜: </h2>
                                <div class="col-12-xsmall">
                                    <input type="text" name="title" id="title"  placeholder="Name" />
                                </div>
                            </div>
                            <div class="row">
                                <h2> 인도: </h2>
                                <div class="col-12-xsmall">
                                    <input type="text" name="guidename" id="GuideName" placeholder="Name" />
                                </div>
                            </div>

                            <div class="row">
                                <h2>기도: </h2>
                                <div class="col-12-xsmall">
                                    <input type="text" name="prayname" id="PrayName" placeholder="Name" />
                                </div>
                            </div>
                            <div class="row">
                                <h2>교독: </h2>
                                <div class="col-12-xsmall">
                                    <input type="text" name="respname" id="RespName" placeholder="Name" />
                                </div>
                            </div>
                            <div class="row">
                                <h2>헌금: </h2>
                                <div class="col-12-xsmall">
                                    <input type="text" name="offername" id="OfferName" placeholder="Name" />
                                </div>
                            </div>
                        </div>
                    </header>

                    <hr class="Start" />

                    <h2>예배로의 부름-인도자</h2>

                    <hr class="Song" />

                    <h2>송영-"만복의 근원 하나님"</h2>
                    <p>만복의 근원 하나님 온 백성 찬송 드리고<br>
                        저 천사여 찬송하세 찬송 성부 성자 성령 아멘</p>
                    <span class="image fit"><img src="images/만복의 근원 하나님.jpg" alt="" /></span>

                    <hr class="Response" />
                    <div class="row">
                        <h2>교독 - </h2>
                        <div class="col-12-xsmall">
                            <input type="text" name="resp">장
                        </div>
                        <div class="col-12-xsmall">
                            <button id="getVersicle" type="submit" formmethod="post" onclick="javascript: form.action='/versicle';">가져오기</button>
                        </div>
                        <div id="RespList"></div>
                    </div>

                    <hr class="ApostleCreed" />
                    <h2>신앙고백-사도신경</h2>
                    <p>나는 전능하신 아버지 하나님, 천지의 창조주를 믿습니다.<br>
                        나는 그의 유일하신 아들, 우리 주 예수 그리스도를 믿습니다.<br>
                        그는 성령으로 잉태되어 동정녀 마리아에게서 나시고, <br>
                        본디오 빌라도 치하에서 고난을 받아 십자가에 못 박혀 죽으시고,<br>
                        장사된 지 사흘 만에 죽은 자 가운데서 다시 살아나셨으며,<br>
                        하늘에 오르셔서 전능하신 아버지 하나님 우편에 앉아 계시다가,<br>
                        거기로부터 살아있는 자와 죽은 자를 심판하러 오십니다.<br>
                        나는 성령을 믿으며, 거룩한 공교회와 성도의 교제와<br>
                        죄를 용서받는 것과 몸의 부활과 영생을 믿습니다.<br>
                        아멘.</p>

                    <hr class="Song2" />
                    <a id="Song2"></a>
                    <h2>찬양-찬양팀</h2>
                    <input type="file" name="files" multiple="multiple" id="files"/>
                    <button type="button" id="uploadBtn">가져오기</button>
<!--                    <ol>-->
<!--                        <li th:each="item : ${ccmList}">-->
<!--                            <p th:text="${item.image.substring(0, item.image.lastIndexOf('.'))}"></p>-->
<!--                        </li>-->
<!--                    </ol>-->
<!--                    <ul style="list-style: none;">-->
<!--                        <li th:each="item : ${ccmList}">-->
<!--                            <span class="image fit"><img th:src="${item}" th:alt="${item.substring(0, item.image.lastIndexOf('.'))}" /></span>-->
<!--                        </li>-->
<!--                    </ul>-->
                    <div id="previewImages"></div>

                    <!--위의 기도 입력에서 가져오도록 javascript 설정 필요-->
                    <hr class="Pray" />
                    <h2>기도-</h2>
                    <!--여기까지-->

                    <hr class="Read" />
                    <a id="Read"></a>
                    <div class="row">
                        <h2>성경 봉독 - </h2>
                        <div class="col-12-xsmall">
                            <select name="testament">
                                <option value="구">구약</option>
                                <option value="신">신약</option>
                            </select>
                        </div>
                        <div class="col-12-xsmall">
                            <input type="text" name="long_label">찾고싶은 성경전서
                        </div>
                        <div class="col-12-xsmall">
                            <input type="text" name="chapters">장
                        </div>
                        <div class="col-12-xsmall">
                            <input type="text" name="first">시작하는 절
                        </div>
                        <div class="col-12-xsmall">
                            <input type="text" name="last">끝나는 절
                        </div>
                        <div class="col-12-xsmall">
                            <button id="getBible" type="button">가져오기</button>
                        </div>
                        <div id="BibleList"></div>
                    </div>

                    <hr class="Offering" />
                    <br>
                    <h2>헌금</h2>
                    <!--이 파트는 다음 주에도 다시 쓸 수 있도록 해야 함-->
                    <hr class="Notice" />
                    <h2>연합 광고</h2>
                    <textarea id="Notice" name="Notice" class="Notice" placeholder="Enter your message" rows="6"></textarea>
                    <br>

                    <h2>부서 광고</h2>
                    <h4><청년1부></h4>
                    <textarea id="Notice1" name="Notice1" class="Notice" placeholder="Enter your message" rows="6">[[${savenotice1}]]</textarea>
                    <br>
                    <h4><청년2부></h4>
                    <textarea id="Notice2" name="Notice2" class="Notice" placeholder="Enter your message" rows="6">[[${savenotice2}]]</textarea>
                    <br>
                    <h4><청년3부></h4>
                    <textarea  id="Notice3" name="Notice3" class="Notice" placeholder="Enter your message" rows="6">[[${savenotice3}]]</textarea>
                    <br>
                    <!--여기까지-->

                    <hr class="Sermon" />
                    <div class="row">
                        <h2>설교 - </h2>
                        <div class="col-12-xsmall">
                            <input type="text" th:name="speachname" />
                        </div>
                    </div>
                    <!--<div class="row">
                        <h3>주제: </h3>
                        <div class="col-6">
                            <input type="text" name="Topic" id="Topic" value="" placeholder="Enter the message" />
                            <br>
                            <br>
                        </div>

                        &lt;!&ndash;사용자가 원할 때 +버튼 눌러서 추가할 수 있도록 한다.&ndash;&gt;
                        <div class="row">
                            <h4>1.</h4>
                            <div class="">
                                <select name="book1" id="book1">
                                    <option value="1">시편</option>
                                    <option value="2">데살로니가전서</option>
                                </select>
                            </div>
                            <div class="">
                                <input type="text" name="chap1" id="chap1">
                            </div>
                            <h3>장 </h3>
                            <div class="">
                                <input type="text" name="verse1" id="verse1">
                            </div>
                            <h3>절~</h3>
                            <div class="">
                                <input type="text" name="verse2" id="verse2">
                            </div>
                            <h3>절</h3>
                        </div>
                    </div>-->
                    <!--여기까지-->

                    <hr class="Pray2" />
                    <h2>기도</h2>

                    <hr class="Song3" />
                    <h2>송영-찬송가 5장</h2>
                    <p>이 천지간 만물들아 복 주시는 주 여호와<br>
                        전능 성부 성자 성령 찬송하고 찬송하세 아멘.</p>
                    <span class="image fit"><img src="images/이 천지간 만물들아.jpg" alt="" /></span>

                    <hr class="Benediction">
                    <h2>축도</h2>

                    <hr class="NextWeek">
                    <h2>다음 주 예배</h2>
                    <div class="row">
                        <h3>기도: </h3>
                        <div class="col-12-xsmall">
                            <input type="text" name="nprayname" id="nprayname" placeholder="Name" />
                        </div>

                        <h3>교독: </h3>
                        <div class="col-12-xsmall">
                            <input type="text" name="nrespname" id="nrespname" placeholder="Name" />
                        </div>

                        <h3>헌금: </h3>
                        <div class="col-12-xsmall">
                            <input type="text" name="noffername" id="noffername" placeholder="Name" />
                        </div>
                    </div>
                </section>
                <button type="button" id="test">주보 테스트</button>
                <button type="button" id="createBtn">주보 만들기</button>
            </form>
        </div>
    </div>
    </form>
    <!-- Sidebar -->
    <div id="sidebar">
        <div class="inner">
            <!-- Search -->
            <section id="search" class="alt">
                <form method="post" action="#">
                    <input type="text" name="query" id="query" placeholder="Search" />
                </form>
            </section>

            <!-- Menu -->
            <nav id="menu">
                <header class="major">
                    <h2>Menu</h2>
                </header>
                <ul>
                    <li><a th:href="@{/}">메인</a></li>
                    <li><a th:href="@{/create}">주보 생성</a></li>
                    <li><a th:href="@{/page}">주보 목록</a></li>
                </ul>
            </nav>
            <!-- Section -->
            <section>
                <header class="major">
                    <h2>문의</h2>
                    <ul class="contact">
                        <li class="icon solid fa-envelope"><a href="#">2001cupid@naver.com</a></li>
                        <li class="icon solid fa-phone">02-415-1323</li>
                        <li class="icon solid fa-home">05572 서울특별시 송파구 올림픽로4길 17, A-201</li>
                    </ul>
                </header>
            </section>
            <!-- Footer -->
            <footer id="footer">
                <p class="copyright">&copy; Lamp Church. All rights reserved.</p>
            </footer>
        </div>
    </div>

</div>
<div th:unless="${#httpServletRequest.getSession(false) != null}">
    <script>
        alert("로그인이 필요합니다.");
        window.history.back();
    </script>
</div>
<!-- Scripts -->
<script>
    $(document).ready(function(){
        // 주보 정보 처리
        let title = $('#title').val();
        let guidename = $('#guidename').val();
        let prayname = $('#prayname').val();
        let respname = $('#respname').val();
        let offername = $('#offername').val();
        let long_label = $('input[name=long_label]').val();
        let Notice = $('#Notice').val();
        let Notice1 = $('#Notice1').val();
        let Notice2 = $('#Notice2').val();
        let Notice3 = $('#Notice3').val();
        let speachname = $('#speachname').val();
        let nprayname = $('#nprayname').val();
        let nrespname = $('#nrespname').val();
        let noffername = $('#noffername').val();

        // 교독문 가져오기
        $('#getVersicle').on('click', function(e){
            e.preventDefault();
            let resp = $('input[name=resp]').val();
            $.ajax({
                type:'post'
                , url: '/versicle'
                , data:{"resp":resp}
                , success: function(data) {
                    $('#RespList').empty();
                    if (data.result.length > 0) {
                       for(let i=0; i<data.result.length;i++){
                           $('#RespList').append("<p>" + data.result[i].sentence + "</p>");
                        }
                        // Append a new <p> tag with the sentence
                        //$('#RespList').append("<p>" + item.sentence + "</p>");
                    } else {
                        alert("교독문을 찾을 수 없습니다!");
                    }
                },
                error: function() {
                    alert("교독문을 가져오는 데 실패했습니다!");
                }
            });
        });

        // 성경 구절 가져오기
        $('#getBible').on('click', function(e){
            e.preventDefault();
            let testament = $("select[name=testament]").val();
            let long_label = $('input[name=long_label]').val();
            let chapters = $('input[name=chapters]').val();
            let first = $('input[name=first]').val();
            let last = $('input[name=last]').val();

            $.ajax({
                type:'post'
                , url: '/bible'
                , data:{"testament":testament, "long_label":long_label, "chapters":chapters, "first":first, "last":last}
                , success: function(data) {
                    $('#BibleList').empty();
                    if (data.result.length > 0) {
                        for(let i=0; i<data.result.length;i++){
                            $('#BibleList').append("<p>" + data.result[i].paragraph + "&nbsp" + data.result[i].sentence + "</p>");
                        }
                        // Append a new <p> tag with the sentence
                        //$('#RespList').append("<p>" + item.sentence + "</p>");
                    } else {
                        alert("성경 구절을 찾을 수 없습니다!");
                    }
                },
                error: function() {
                    alert("성경 구절을 가져오는 데 실패했습니다!");
                }
            });
        });

        // 다중 파일 처리
        var inputFileList = new Array();

        $('input[name=files]').on('change', function(e) {
            inputFileList = [];  // 이미지 배열 초기화

            var files = e.target.files;
            var filesArr = Array.prototype.slice.call(files);

            // 업로드 된 파일 유효성 체크
            if (filesArr.length > 3) {
                alert("이미지는 최대 3개까지 업로드 가능합니다.");
                $('input[name=files]').val();
                return;
            }

            filesArr.forEach(function(f) {
                inputFileList.push(f);    // 이미지 파일을 배열에 담는다.
            });
        });

        // 파일 미리보기
        $('#uploadBtn').on('click', function() {
            updatePreviewImages(inputFileList);
        });

        // 파일 미리보기 업데이트
        function updatePreviewImages(files) {
            const previewImagesDiv = $('#previewImages');
            previewImagesDiv.empty(); // 기존 미리보기 삭제

            for (let i = 0; i < files.length; i++) {
                const fileName = files[i].name;
                const imageElement = document.createElement('img');
                imageElement.src = URL.createObjectURL(files[i]);
                // 파일 이름 추가
                const sequenceNumber = i + 1;
                const fileNameElement = document.createElement('p');
                fileNameElement.textContent = `${sequenceNumber}. ${fileName}`;
                // 이미지 미리보기 추가
                previewImagesDiv.append(imageElement);

                // 파일 이름 추가
                previewImagesDiv.append(fileNameElement);
            }
        }

        $('#createBtn').on('click', function(){
            console.log("inputFileList: " + inputFileList);

            let formData = new FormData($('#uploadForm')[0]);  // 폼 객체
            let resp = $('input[name=resp]').val();
            let chapters = $('input[name=chapters]').val();
            let first = $('input[name=first]').val();
            let last = $('input[name=last]').val();

            formData.append("title", title);
            formData.append("guidename", guidename);
            formData.append("prayname", prayname);
            formData.append("respname", respname);
            formData.append("offername", offername);
            formData.append("resp", resp);
            formData.append("long_label", long_label);
            formData.append("chapters", chapters);
            formData.append("first", first);
            formData.append("last", last);
            formData.append("Notice", Notice);
            formData.append("Notice1", Notice1);
            formData.append("Notice2", Notice2);
            formData.append("Notice3", Notice3);
            formData.append("speachname", speachname);
            formData.append("nprayname", nprayname);
            formData.append("nrespname", nrespname);
            formData.append("noffername", noffername);

            for (let i = 0; i < inputFileList.length; i++) {
                formData.append("file", inputFileList[i]);  // 배열에서 이미지들을 꺼내 폼 객체에 담는다.
            }

            $.ajax({
                type:'post'
                , enctype:"multipart/form-data"  // 업로드를 위한 필수 파라미터
                , url: '/create'
                , data: formData
                , processData: false   // 업로드를 위한 필수 파라미터
                , contentType: false   // 업로드를 위한 필수 파라미터
                , success: function(data) {
                    if(data.code == 200){
                        alert("주보가 성공적으로 생성되었습니다!");
                        location.href = "/page";
                    } else {
                        alert('주보 업로드에 실패했습니다.....');
                    }
                }
                , error: function(e) {
                    alert("error:" + e);
                }
            });
        });
    });
</script>
</body>
</html>